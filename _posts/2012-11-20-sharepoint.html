---
layout: post
title: "Как писать правильный код для SharePoint"
date: '2012-11-20T14:40:00.000+04:00'
author: "Станислав Выщепан"
tags:
- SharePoint
modified_time: '2012-11-20T16:00:03.228+04:00'
blogger_id: tag:blogger.com,1999:blog-1302241583051203640.post-3143026358725285572
blogger_orig_url: http://blog.gandjustas.ru/2012/11/sharepoint.html
redirect_from: /2012/11/sharepoint.html
---

<p>Сегодня наткнулся на <a href="http://www.gotdotnet.ru/forums/5/144136/" target="_blank">этот потрясающий пост на GotDotNet</a>. Код в 20 строк изобилует практически всеми ошибками, которые можно совершить при разработке для SharePoint. </p>  <p>Некоторое время назад я написал небольшой список правил, которых следует придерживаться при разработке веб-частей, большинство их правил также верны и для разработки других артефактов.</p>  <p>Привожу текст письма с правилами “как есть”:</p>  <blockquote>   <p><em>Господа, давайте сразу делать веб-части для главной НОРМАЛЬНО</em></p>    <p><em>1. Никаких visual web part, используйте sandboxed visual web part</em></p>    <p><em>2. Никаких ссылок на скрипты и css в разметке, используйте классы CssRegistratoin и ScriptLink</em></p>    <p><em>3. Получение списков только через web.GetList(SPUrlUtility.CombineUrls(web.Url, listRelativeUrl)</em></p>    <p><em>4. Списки для веб-частей на главной лежат в корневом сайте, доступ к которому только через SPContext.Current.Site.RootWeb</em></p>    <p><em>5. Никаких вызов конструкторов SPSite и site.OpenWeb крайней необходимости</em></p>    <p><em>6. В JS учитывайте что может быть много экземпляров веб-частей на странице, передавайте в скрипты id элементов с помощью control.ClientID</em></p>    <p><em>7. Так как веб-части на страницу могут быть добавлены после постбека – <b>не используйте</b> Page.IsPostBack для проверки первой загрузки</em></p>    <p><em>8. Лучший вариант – грузите данные в createchildcontrols</em></p>    <p><em>9. Используйте репитеры вместо склейки HTML в коде</em></p>    <p><em>10. Вставляйте везде SPMonitoredScope</em></p>    <p><em>11. Структурируйте код так, чтобы загрузка данных была отделена от генерации HTML (чтобы можно было кеширование прикрутить)</em></p>    <p><em>12. Отключайте по возможности ViewState</em></p>    <p><em>13. Обрабатывайте ошибки, чтобы при ошибке в веб-части не падала страница. Надо обрабатывать SPException, FileNotFoundException (сайт не найден, нет доступа), DirectoryNoFoundException (список не найден, нет доступа)</em></p>    <p><em>14. Если напишите try с пустым catch – оторву йайтса</em></p>    <p><em>15. Ошибки пишите в лог и выводите в красном Literal на страницу</em></p>    <p><em>16. Используйте только exception.ToString()</em></p>    <p><em>17. Корректно обрабатывайте случаи отсутствия элементов при выводе</em></p>    <p><em>18. На странице может быть две одинаковые веб-части и они должны корректно работать</em></p>    <p><em>Две ссылки по теме:</em></p>    <p><a href="http://msdn.microsoft.com/en-us/library/bb985502(v=office.12).aspx"><em>http://msdn.microsoft.com/en-us/library/bb985502(v=office.12).aspx</em></a></p>    <p><a href="http://msdn.microsoft.com/en-us/library/dd583141(v=office.11).aspx"><em>http://msdn.microsoft.com/en-us/library/dd583141(v=office.11).aspx</em></a></p> </blockquote>  <p>PS. Пункт 1 актуален для Visual Studio 2010, в 2012 такие веб-части создаются по-умолчанию.</p>  
