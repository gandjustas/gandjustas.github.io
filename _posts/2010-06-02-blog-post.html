---
layout: post
title: "Про виды разграничения прав"
date: '2010-06-02T11:50:00.001+04:00'
author: "Станислав Выщепан"
tags:
- security
- claims
- RBS
modified_time: '2010-06-02T11:50:09.360+04:00'
blogger_id: tag:blogger.com,1999:blog-1302241583051203640.post-3351464099171278356
blogger_orig_url: http://blog.gandjustas.ru/2010/06/blog-post.html
---

<p><em>Кросс-пост с RSDN</em></p>  <h4>Классическая rbs (role-based security)</h4>  <p>Есть <strong>Роли</strong>, <strong>Пользователи</strong> могут иметь несколько ролей, <strong>Роли</strong> имеют несколько <strong>Разрешений</strong>.    <br />То есть между <strong>Пользователями</strong> и <strong>Ролями</strong> связь многие-ко-многим, и между <strong>Ролями</strong> и <strong>Разрешениями</strong> многие-ко-многим.    <br />Такая модель эффективна для небольших приложений, где роли определены и зачастую совпадают с ролями в процессе, а разрешения выдаются на некоторые действия.    <br />Фактически Роль определяет как группу пользователей, так и что они могут делать.</p>  <h4>Настраиваемая RBS</h4>  <p>Тут роли разделяются на <strong>группы</strong> пользователей и <strong>наборы разрешений</strong>. <strong>Пользователи</strong> связаны многие-ко-многим с <strong>группами</strong>, <strong>группы</strong> — многие-ко-многим с<strong> наборами разрешений</strong>,<strong> наборы разрешений</strong> — многие-ко-многим <strong>разрешениями</strong>.    <br />Разрешения также выдаются на некоторые действия, но при большом количестве удобнее управлять согласованными наборами разрешений, а не отдельными разрешениями. Наборы разрешений можно изменять в процессе работы программы, как и группы пользователей.    <br />По опыту такая система сложнее классической раз в пять. Поэтому без необходимости городить не стоит.    <br /></p>  <h4>Claims-based security</h4>  <p>Почти тоже самое что и предыдущий пункт, только вместо групп пользователей используются <strong>claim</strong>_ы которые могу иметь разный тип (имеется ввиду бизнес-тип). Типичные claims - это имя пользователя, группы (может быть несколько), email, в бизнес-приложениях это также может быть имя менеджера, отдел итп.    <br />Таким образом пользователи имеет много claim_ов, каждый claim определяется парой (тип, значение),<strong> набор разрешений</strong> привязывается к набору <strong>claim</strong>_ов.</p>  <p>А теперь самое интересное. Система разграничения прав в приложениях с CBS часто оказывается <i>проще</i>, чем RBS в настраиваемом вида. RBS заставляет плодить много групп, в том числе автоматически. При использовании CBS от этого можно совсем отказаться, а сам механизм получения claim_ов вынести отдельно, что уменьшит сложность самого приложения (например Windows Identity Foundation так и работает, и позволяет сделать claims-provider, работающий с AD).    <br />Кроме того возможен fallback к RBS — достаточно один из типов claim_ов объявить группой\ролью.</p>  <p>   <br />Это неполный список, всегда можно придумать вариации.</p>  <h5>Все выше касалось ограничения на выполнение функций системы, теперь мы хотим защищать доступ к объектам в системе.</h5>  <p>Поначалу все просто : связь роль-разрешения, группа-группа разрешений, набор claim_ов — группа разрешений становится тренарной, то есть к каждой связи добавляет атрибут — ссылка на объект. Тогда сама связь, указывающая что для данного объекта данная роль имеет указанные разрешения становится неким ACE (Access Control Entry из терминологии Windows), множество ACE, сгруппированных по ссылке на объект, называются ACL (Access Control List).</p>  <p>   <br />Вроде все просто, но при построении такой системы надо решить несколько принципиальных вопросов:</p>  <ol>   <li>Вычисление &quot;эффективных разрешений&quot;. При наличии иерархии защищаемых объектов надо уметь однозначно получать разрешения которые действуют для данного объекта, с учетом разрешений вышестоящих объектов. Прием если связи между объектами имеют циклы, то однозначность становится проблемой.</li>    <li>Владение объектом. Зачастую при вычислении возможности доступа нужно учитывать кто создал этот объект и как авторство объекта влияет на эффективные разрешения.</li>    <li>Как с учетом вышесказанного сделать чтобы это быстро работало. Проверка разрешений и так усложняет выборки данных, а если еще требуется вычислять эффективные разрешения с учетом иерархии, то это может очень сильно сказаться на производительности.</li> </ol>  <p>Часто такую систему называют Row-Level Securty, потому что проверки реализуются на уровне строк БД, иначе очень медленно будет.</p>  