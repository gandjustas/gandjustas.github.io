---
layout: post
title: "Процессинг в SharePoint"
date: '2011-03-30T18:43:00.001+04:00'
author: "Станислав Выщепан"
tags:
- SharePoint
modified_time: '2011-03-30T18:47:57.983+04:00'
blogger_id: tag:blogger.com,1999:blog-1302241583051203640.post-2521650335425306704
blogger_orig_url: http://blog.gandjustas.ru/2011/03/sharepoint.html
redirect_from: /2011/03/sharepoint.html
---

<p>SharePoint обладает всеми свойствами распределенной БД. Разные семейства сайтов могут находиться в разных контентных базах данных. Разные контентные БД могут находиться на разных серверах. Запросы к структурированным данным работают небыстро и самый эффективный способ – обращение по ключу. Часто используется поиск для нахождения нужных данных во всей базе.</p>  <p>Для того чтобы обрабатывать много данных в базах SharePoint&#160; используются задачи таймера, которые выполняют запросы к БД и обрабатывают полученные данные. Но не для всех случаев запросы можно выполнить эффективно.</p>  <p>Например попробуем спроектировать фичу уведомлений о наступлении некоторой даты. Например предупреждать за несколько дней заинтересованных лиц о наступлении события из календаря с возможностью выбора поля даты, для которого будет приходить уведомление.</p>  <p>Нам обязательно понадобится задача таймера, которая будет бегать по <strong>всем</strong> спискам <strong>всех</strong> коллекций сайтов <strong>всех</strong> баз данных в пределах одного приложения с целью найти нужные элементы для уведомлений. Такой подход отметаем сразу как не масштабируемый.</p>  <p>Другой подход – создавать процесс с ожиданием до заданного времени. Но процессы тяжеловесны и их использование отражается на интерфейсе пользователя. Кроме того есть ограничения на количество работающих процессов в SharePoint. Тоже плохо масштабируется</p>  <p>Нам нужен способ позволяющий передать данные из <em>фронтэнда</em> (веб-приложения) в <em>бекэнд</em> (службу таймера). В распределенных приложениях для этого используются <em>очереди</em>. Но беглый просмотр API шарепоинта говорит нам что очередей нет, а в SharePoint 2010 нельзя из контекста веб-приложения изменить свойства объектов, унаследованных от SPPersitedObject (подробнее <a href="http://unclepaul84.blogspot.com/2010/06/sppersistedobject-xxxxxxxxxxx-could-not.html" target="_blank">тут</a>), и мы не можем записать что-либо в сам объект задачи таймера или в любой дочерний.</p>  <p>Более детальный просмотр Server OM показал одну маленькую функцию <a href="http://msdn.microsoft.com/en-us/library/ms476803.aspx" target="_blank">SPSite.AddWorkItem</a>, которая добавляет куда-то workitem, и класс <a href="http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spworkitemjobdefinition.aspx" target="_blank">SPWorkItemJobDefinition</a> наследуясь от которого можно определить задачу таймера, разгребающую эти workitem. Вот где прятались очереди в sharepoint. </p>  <p>Таким образом мы можем в обработчике события на изменение элемента ставить задачу в очередь, указывая дату и время когда она должна быть обработана, а обо всем остальном позаботятся внутренние механизмы.</p>  <p>Удивляет отсутствие толковой документации и примеров использования этого метода. Похоже что это внутренний механизм, который частично торчит наружу, но далеко не до всех деталей, которые используют процессы и алерты (да-да, они именно такой метод используют) можно добраться. Тем не менее то что доступно вполне можно использовать для своих целей.</p>  
