---
layout: post
title: Code Review vs Testing
date: '2013-07-24T10:00:00.000+04:00'
author: "Станислав Выщепан"
tags:
- testing
- codereview
- SharePoint
modified_time: '2013-07-24T10:00:00.766+04:00'
blogger_id: tag:blogger.com,1999:blog-1302241583051203640.post-5769285929442275388
blogger_orig_url: http://blog.gandjustas.ru/2013/07/code-review-vs-testing.html
redirect_from: /2013/07/code-review-vs-testing.html
category: Эффективность
---

<p>Почти все знают, что баг в программе, исправленный на этапе использования, стоит примерно в 100 раз дороже, чем исправленный до использования. Кто не верит – может почитать результаты исследования <a title="Shull defects paper" href="http://kev.inburke.com/docs/shull_defects.pdf">Shull defects paper</a>.</p> <p>Если спросить программистов какой метод исправления поиска и исправления багов наиболее эффективный, то большинство ответит - “тестирование”. И будут неправы…</p> <h3>Эффективность различных методов устранения ошибок</h3> <p>В книге МакКоннелла CodeComplete есть статистика (да-да, все её читали, но никто сходу не может вспомнить что там написано), которая разрывает мозг многим апологетам тестов.</p> <table cellspacing="0" cellpadding="2" width="536" border="1"> <tbody> <tr> <td valign="top" width="337"><strong>Методика</strong></td> <td valign="top" width="197" align="center"> <p align="left"><strong>Результативность в среднем</strong></p></td></tr> <tr> <td valign="top" width="335">Regression test</td> <td valign="top" width="199" align="center">25%</td></tr> <tr> <td valign="top" width="333">Informal code reviews</td> <td valign="top" width="201" align="center">25%</td></tr> <tr> <td valign="top" width="332">Unit test<strong></strong></td> <td valign="top" width="202" align="center">30%</td></tr> <tr> <td valign="top" width="331">New function (component) test<strong></strong></td> <td valign="top" width="203" align="center">30%</td></tr> <tr> <td valign="top" width="330">Integration test<strong></strong></td> <td valign="top" width="204" align="center">35%</td></tr> <tr> <td valign="top" width="330">Low-volume beta test (&lt; 10 users)<strong></strong></td> <td valign="top" width="204" align="center">35%</td></tr> <tr> <td valign="top" width="330">Informal design reviews</td> <td valign="top" width="204" align="center">35%<strong></strong></td></tr> <tr> <td valign="top" width="330">Personal desk checking of code<strong></strong></td> <td valign="top" width="204" align="center">40%</td></tr> <tr> <td valign="top" width="330">System test</td> <td valign="top" width="204" align="center">40%</td></tr> <tr> <td valign="top" width="330">Formal design inspections</td> <td valign="top" width="204" align="center">55%</td></tr> <tr> <td valign="top" width="330">Formal code inspections</td> <td valign="top" width="204" align="center">60%</td></tr> <tr> <td valign="top" width="330">Modeling or prototyping</td> <td valign="top" width="204" align="center">65%</td></tr> <tr> <td valign="top" width="330">High-volume beta test (&gt; 1000 users)<strong></strong></td> <td valign="top" width="205" align="center">75%</td></tr></tbody></table> <p>То есть в среднем все методы тестирования менее результативны, чем формальные инспекции дизайна и кода. А если еще поделить результативность на затраченное время, то review становится в разы эффективнее тестирования.</p> <h3>Как делать review</h3> <p>Для начала надо почитать того же МакКоннелла, у него все более чем подробно описано. Ключевые моменты:</p> <ul> <li>Чтобы проводить инспекции нужны чек-листы.  <li>Темп code review составляет 120-200 строк в час.  <li>Инспекторов должно быть как минимум два.  <li>Должны быть адекватно описаны требования к коду: быть полными и не содержать противоречий и неточностей.  <li>Код должен компилироваться. <li>Код должен быть проверен разработчиком, как минимум выполнять основные сценарии на его машине.</li></ul> <p>В настоящий момент существует множество инструментов для code review, в том числе встроенных в средства разработки, поэтому необходимость в review meeting значительно ниже. Возможно для review верхнеуровневого дизайна потребуется совещание, но для review кода митинги скорее вредны.</p> <h3>Как повысить эффективность code review</h3> <p>Средняя продолжительность продуктивного писания кода – 4-5 часов в день. То есть 3-4 часа в день программист не занимается написанием кода, или занимается, но лучше бы этого не делал. Можно скорректировать время работы программистов, чтобы 4 часа в день они писали код, два часа делали review, еще два часа занимались проектированием, митингами и административными задачам. То есть review получается практически бесплатно.</p> <p>Команда в 3-4 человека будет вполне успевать проводить review написанного за день кода в оставшиеся 2 часа после кодирования.</p> <p>Значительную часть review можно автоматизировать, есть множество инструментов, которые проверяют качество кода.</p> <h3>Если все так круто, то почему же все занимаются тестированием?</h3> <p>Ответ на этот вопрос я долго искал, пока не наткнулся на презентацию Эрика Липперта о психологических аспектах анализа кода (<a title="http://www.slideshare.net/Coverity/the-psychology-of-c-analysis-24025354" href="http://www.slideshare.net/Coverity/the-psychology-of-c-analysis-24025354">http://www.slideshare.net/Coverity/the-psychology-of-c-analysis-24025354</a>). Несмотря на то, что в презентации рассказывается об автоматизированном анализе, причины недоверия более чем верны для code review.</p> <p>Основная причина – психология программистов. Для проведения review необходимо взаимодействовать с людьми, получать от них замечания к <em>своему</em> коду. Психологически это гораздо тяжелее, чем писать тесты к своему коду. </p> <p>Вы наверное и сами обращали внимание, что смотреть чужой код и находить в нем ошибки бывает даже интересно. А вот когда ваш код кто-то смотрит и указывает на ошибки в нем – уже вызывает дискомфорт, а у некоторых откровенное неприятие.</p> <p>Кроме того тесты это тоже код, это значит менеджер может посмотреть чем программист занимался. А еще лучше если менеджер посмотрит результаты тестового покрытия, хотя эта величина практически бесполезна.</p> <h3>Заключение</h3> <p>Несколько статей про code review, в них есть много интересных ссылок на исследования и книги:</p> <ul> <li><a title="http://kev.inburke.com/kevin/the-best-ways-to-find-bugs-in-your-code/" href="http://kev.inburke.com/kevin/the-best-ways-to-find-bugs-in-your-code/">http://kev.inburke.com/kevin/the-best-ways-to-find-bugs-in-your-code/</a></li> <li><a title="http://monead.com/blog/?p=1291" href="http://monead.com/blog/?p=1291">http://monead.com/blog/?p=1291</a></li> <li><a title="http://www.developer.com/tech/article.php/3579756/Effective-Code-Reviews-Without-the-Pain.htm" href="http://www.developer.com/tech/article.php/3579756/Effective-Code-Reviews-Without-the-Pain.htm">http://www.developer.com/tech/article.php/3579756/Effective-Code-Reviews-Without-the-Pain.htm</a></li> <li><a title="http://www.codinghorror.com/blog/2006/01/code-reviews-just-do-it.html" href="http://www.codinghorror.com/blog/2006/01/code-reviews-just-do-it.html">http://www.codinghorror.com/blog/2006/01/code-reviews-just-do-it.html</a></li> <li><a title="http://accelerateddevelopment.ca/blog/inspections-are-not-optional/" href="http://accelerateddevelopment.ca/blog/inspections-are-not-optional/">http://accelerateddevelopment.ca/blog/inspections-are-not-optional/</a></li></ul> <p>Немного про SharePoint. Джентльменский набор для анализа кода:</p> <ul> <li><a title="http://www.spcaf.com/" href="http://www.spcaf.com/">http://www.spcaf.com/</a></li> <li><a title="http://archive.msdn.microsoft.com/SPDisposeCheck" href="http://archive.msdn.microsoft.com/SPDisposeCheck">http://archive.msdn.microsoft.com/SPDisposeCheck</a></li> <li><a title="http://www.jetbrains.com/resharper/" href="http://www.jetbrains.com/resharper/">http://www.jetbrains.com/resharper/</a></li> <li><a title="http://stylecop.codeplex.com/" href="http://stylecop.codeplex.com/">http://stylecop.codeplex.com/</a></li> <li>FxCop\Visual Studio Code Analysis</li> <li><a title="http://vswebessentials.com/" href="http://vswebessentials.com/">http://vswebessentials.com/</a> (встроенный <a href="http://www.jshint.com/" target="_blank">JSHint</a>)</li> <li><a href="http://gandjustas.blogspot.ru/2012/11/sharepoint.html" target="_blank">http://gandjustas.blogspot.ru/2012/11/sharepoint.html</a></li> <li><a title="http://gandjustas.blogspot.ru/2012/12/sharepoint.html" href="http://gandjustas.blogspot.ru/2012/12/sharepoint.html">http://gandjustas.blogspot.ru/2012/12/sharepoint.html</a></li> <li><a title="http://www.rharbridge.com/?page_id=259" href="http://www.rharbridge.com/?page_id=259">http://www.rharbridge.com/?page_id=259</a></li></ul> <p>ЗЫ. Все написанное выше не означает что надо бросить тестирование и все силы перекинуть на review. У того же МакКоннелла написано, что наибольший эффект достигается при применении минимум трех методик.</p>  
