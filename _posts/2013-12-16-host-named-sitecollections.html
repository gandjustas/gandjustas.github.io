---
layout: post
title: Host-Named SiteCollections
date: '2013-12-16T10:00:00.000+04:00'
author: "Станислав Выщепан"
tags:
- SharePoint 2013
- sp2013
- Architecture
modified_time: '2013-12-16T13:29:00.491+04:00'
blogger_id: tag:blogger.com,1999:blog-1302241583051203640.post-6683008063795726127
blogger_orig_url: http://blog.gandjustas.ru/2013/12/host-named-sitecollections.html
---

<p>В SharePoint 2013 без большого шума появилась новая best-practice, рекомендующая использовать так называемые Host-Named SiteCollection (HNSC). Как обычно это вызывает множество вопросов, на которые я попробую ответить.</p>  <h3>Краткий экскурс в историю</h3>  <p>Во времена x86 процессоров максимальный объем адресного пространства, которое могло занимать приложение – 2гб. Поэтому для масштабирования был выбран подход, когда вся ферма SharePoint разбивается на несколько “веб-приложений”, каждое из которых представляет один или несколько сайтов на IIS. Тем не менее создание сайтов на IIS – дорогое удовольствие. Каждый сайт запускает как минимум один процесс w3wp, который загружает сборки SharePoint и съедает немало памяти. Поэтому даже придумали лимит веб-приложений.</p>  <p>Еще один фактор, который подталкивает плодить веб-приложения в SharePoint – безопасность. Каждое веб-приложение содержит множество коллекций сайтов, все имеют <em>общий</em> hostname. Это значит что javascript из одной коллекции сайтов может обращаться к ресурсам другой коллекции с правами текущего пользователя (Cross-Site Scripting). А для добавления JavaScript достаточно иметь права хотя бы на одно узле.</p>  <p>Таким образом даже появление x64 версий SharePoint не изменило картину – все использовали веб-приложения и отдельные сайты IIS.</p>  <p>HNSC существовали еще в SharePoint 2003 (только назывались не так). Они позволяли иметь коллекции сайтов с <em>разными</em> hostname в рамках одного веб-приложения SharePoint. Но из-за ограничений и сложностей использования не прижились. В SharePoint 2010 произошло улучшение HNSC в первую очередь для Office 365.</p>  <p>В SharePoint 2013 снова улучшили HNSC и появились некоторые возможности\особенности платформы, которые делают HNSC лучшим выбором.</p>  <h3>Для чего нужны HNSC</h3>  <p>Обязательно нужно запомнить (ибо понять это сложно): Host-Named SiteCollection это альтернатива <em>веб-приложениям</em>, а не обычным коллекциям сайтов. При использовании HNSC обычные коллекции сайтов, официально называемые Path-Based SiteCollection, все так же доступны.</p>  <p>Как я писал выше, HNSC позволяют создавать коллекции сайтов с разными hostname в рамках одного веб-приложения. В SharePoint 2013 HNSC также научлись поддерживать несколько hostname в разных зонах и SSL Termination и разные режимы аутентификации на основе зон.</p>  <p>С точки зрения API обычные коллекции сайтов не отличаются от HNSC. Важно только помнить что SPSite.Url&#160; может не совпадать ни с одним из Url в объекте SPSite.WebApplication.</p>  <p>Применять HNSC нужно по трем причинам:</p>  <ol>   <li>Экономия ресурсов.      <br />Все HNSC живут в одном веб-приложении, следовательно в одном процессе w3wp. Это означает, что загружена только одна копия сборок SharePoint, что уменьшает оверхед на пару сотен мегабайт на процесс.      <br /></li>    <li>Совместимость с apps.      <br />Для того чтобы работали apps нужен wildcard-сайт, который принимает запросы на любой hostname, потому что AppWeb создается с уникальным hostname.       <br />Но AppWeb это все еще сайт SharePoint, поэтому требуется загрузка всех объектов SharePoint в процесс веб-сайта, обсуживающего apps.       <br />Если все коллекции сайтов находятся в одном сайте IIS, то это также уменьшает оверхед и упрощает, в итоге, настройку IIS.      <br /></li>    <li>Новые фичи SharePoint 2013.     <br />В SharePoint 2013 появилась фича Request Management, позволяющая управлять WFE. Request Management позволяет задать какой WFE будет обрабатывать запросы какого типа. Конфигурация может быть динамической, учитывающей состояние сервера (нагрузка, ресурсы итд). Microsoft говорит что эта фича тестировалась только с HNSC и в будущем новые фичи будут работать в первую очередь с HNSC.</li> </ol>  <h3>Недостатки HNSC</h3>  <p>Увы использовать HNSC не так просто. Central administration сайт не умеет создавать HNSC, поэтому всю работу надо будет делать в PowerShell.</p>  <p>Тем не менее для любителей тикать мышкой есть проект на codeplex: <a title="https://hnsc.codeplex.com/" href="https://hnsc.codeplex.com/">https://hnsc.codeplex.com/</a><a href="https://hnsc.codeplex.com/" target="_blank">https://hnsc.codeplex.com/</a>.</p>  <p>Кроме того HNSC обеспечивают гораздо меньшую изоляцию ресурсов сервера, по сравнению с веб-приложениями. Все HNSC будут иметь общие настройки веб-приложения, такие как throttling, настройки корзины, настройки безопасности и аутентификации, общие managed paths, итд. У всех HNSC будет общий web.config и общий app pool. Это значит что установка приложений будет затрагивать все HNSC.</p>  <h3>Как создавать HNSC</h3>  <p>Я не буду писать множество PowerShell команд для создания и настройки HNSC. На MSDN есть прекрасный гайд по HNSC (даже с достойным переводом на русский язык), который описывает разные топологии, а также процесс перехода от Path-based sitecollections к HNSC. </p>  <p>Ссылка на гайд: <a title="http://technet.microsoft.com/ru-ru/library/cc424952.aspx" href="http://technet.microsoft.com/ru-ru/library/cc424952.aspx" target="_blank">http://technet.microsoft.com/ru-ru/library/cc424952.aspx</a>.</p>  <p>Дополнительные материалы для тех, кто решит использовать HNSC:</p>  <ul>   <li><a title="http://blogs.msdn.com/b/kaevans/archive/2012/03/27/what-every-sharepoint-admin-needs-to-know-about-host-named-site-collections.aspx" href="http://blogs.msdn.com/b/kaevans/archive/2012/03/27/what-every-sharepoint-admin-needs-to-know-about-host-named-site-collections.aspx">http://blogs.msdn.com/b/kaevans/archive/2012/03/27/what-every-sharepoint-admin-needs-to-know-about-host-named-site-collections.aspx</a> </li>    <li><a title="http://blogs.msdn.com/b/russmax/archive/2013/10/31/guide-to-sharepoint-2013-host-name-site-collections.aspx" href="http://blogs.msdn.com/b/russmax/archive/2013/10/31/guide-to-sharepoint-2013-host-name-site-collections.aspx">http://blogs.msdn.com/b/russmax/archive/2013/10/31/guide-to-sharepoint-2013-host-name-site-collections.aspx</a></li> </ul>  <h3>Заключение</h3>  <p>Для правильного развертывания SharePoint 2013 уже недостаточно просто воспользоваться визардом. Теперь требуется планирование, анализ требований, вариантов решений которые предлагает SharePoint и оценка всех tradeoffs. А это требует как минимум понимания возможностей SharePoint.</p>  